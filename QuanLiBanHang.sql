CREATE DATABASE QuanLiBanHang
GO
USE QuanLiBanHang
GO
-----------------------------Bài 1---------------------------------
CREATE TABLE KHACHHANG (
	MAKH CHAR(4) NOT NULL,
	HOTEN VARCHAR(40),
	DCHI VARCHAR(50),
	SODT VARCHAR(20),
	NGSINH SMALLDATETIME,
	DOANHSO MONEY,
	NGDK SMALLDATETIME,
	CONSTRAINT PK_KH PRIMARY KEY(MAKH)
)
CREATE TABLE NHANVIEN (
	MANV CHAR(4) NOT NULL,
	HOTEN VARCHAR(40),
	NGVL VARCHAR(20),
	SODT SMALLDATETIME,
	CONSTRAINT PK_NV PRIMARY KEY(MANV)
)
CREATE TABLE SANPHAM (
	MASP CHAR(4) NOT NULL,
	TENSP VARCHAR(40),
	DVT VARCHAR(20),
	NUOCSX VARCHAR(40),
	GIA MONEY,
	CONSTRAINT PK_SP PRIMARY KEY(MASP)
)
CREATE TABLE HOADON (
	SOHD INT NOT NULL,
	NGHD SMALLDATETIME,
	MAKH CHAR(4) REFERENCES dbo.KHACHHANG(MAKH),
	MANV CHAR(4) REFERENCES dbo.NHANVIEN(MANV),
	TRIGIA MONEY,
	CONSTRAINT PK_HD PRIMARY KEY(SOHD)
)
CREATE TABLE CTHD (
	SOHD INT REFERENCES dbo.HOADON(SOHD),
	MASP CHAR(4) REFERENCES dbo.SANPHAM(MASP),
	SL INT,
	CONSTRAINT PK_CTHD PRIMARY KEY(SOHD, MASP)
)
-----------------------------Thực hành 1----------------------------------
-----------------------------Bài 2---------------------------------
--Câu 2:
ALTER TABLE dbo.SANPHAM ADD GHICHU VARCHAR(20)
--Câu 3:
ALTER TABLE dbo.KHACHHANG ADD LOAIKH TINYINT
--Câu 4:
ALTER TABLE dbo.SANPHAM ALTER COLUMN GHICHU VARCHAR(100)
--Câu 5:
ALTER TABLE dbo.SANPHAM DROP COLUMN GHICHU
--Câu 6:
ALTER TABLE dbo.KHACHHANG ALTER COLUMN LOAIKH VARCHAR(20)
--Câu 7:
ALTER TABLE dbo.SANPHAM ADD CONSTRAINT SP_CHECK CHECK(DVT IN ('cay', 'hop', 'cai', 'quyen', 'chuc'))
--Câu 8:
ALTER TABLE dbo.SANPHAM ADD CONSTRAINT GIA_CHECK CHECK(GIA>=500)
--Câu 9:
ALTER TABLE dbo.CTHD ADD CONSTRAINT SL_CHECK CHECK(SL>=1)
--Câu 10:
ALTER TABLE dbo.KHACHHANG ADD CONSTRAINT NGDK_CHECK CHECK(NGDK>NGSINH)

-----------------------------Thực hành 2----------------------------------
----Bài 1: Nhập liệu
SET DATEFORMAT dmy
GO
-- KHACHHANG
INSERT INTO dbo.KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO,	NGDK) VALUES('KH01','Nguyen Van A','731 Tran Hung Dao, Q5, TpHCM','08823451','22/10/1960', 13060000, '22/07/2006')
INSERT INTO dbo.KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO,	NGDK) VALUES('KH02','Tran Ngoc Han','23/5 Nguyen Trai, Q5, TpHCM','0908256478','03/04/1974', 280000, '30/07/2006')
INSERT INTO dbo.KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO,	NGDK) VALUES('KH03','Tran Ngoc Linh','45 Nguyen Canh Chan, Q1, TpHCM','0938776266','12/06/1980', 3860000, '08/05/2006')
INSERT INTO dbo.KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO,	NGDK) VALUES('KH04','Tran Minh Long','50/34 Le Dai Hanh, Q10, TpHCM','0917325476','09/03/1965', 250000, '10/02/2006')
INSERT INTO dbo.KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO,	NGDK) VALUES('KH05','Le Nhat Minh','34 Truong Dinh, Q3, TpHCM','08246108','10/03/1950', 21000, '28/10/2006')
INSERT INTO dbo.KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO,	NGDK) VALUES('KH06','Le Hoai Thuong','227 Nguyen Van Cu, Q5, TpHCM','08631738','31/12/1981', 915000, '24/11/2006')
INSERT INTO dbo.KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO,	NGDK) VALUES('KH07','Nguyen Van Tam','32/3 Tran Binh Trong, Q5, TpHCM','0916783565','06/04/1971', 12500, '12/01/2006')
INSERT INTO dbo.KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO,	NGDK) VALUES('KH08','Phan Thi Thanh','45/2 An Duong Vuong, Q5, TpHCM','0938435756','10/01/1971', 365000, '13/12/2006')
INSERT INTO dbo.KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO,	NGDK) VALUES('KH09','Le Ha Vinh','873 Le Hong Phong, Q5, TpHCM','08654763','03/09/1979', 70000, '14/01/2007')
INSERT INTO dbo.KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO,	NGDK) VALUES('KH10','Ha Duy Lap','34/34B Nguyen Trai, Q1, TpHCM','08768904','02/05/1983', 67500, '16/01/2007')

-- NHANVIEN
INSERT INTO dbo.NHANVIEN VALUES('NV01','Nguyen Nhu Nhut','927345678','13/04/2006')
INSERT INTO dbo.NHANVIEN VALUES('NV02','Le Thi Phi Yen','987567390','21/04/2006')
INSERT INTO dbo.NHANVIEN VALUES('NV03','Nguyen Van B','997047382','27/04/2006')
INSERT INTO dbo.NHANVIEN VALUES('NV04','Ngo Thanh Tuan','913758498','24/06/2006')
INSERT INTO dbo.NHANVIEN VALUES('NV05','Nguyen Thi Truc Thanh','918590387','20/07/2006')

-- SANPHAM
INSERT INTO dbo.SANPHAM VALUES('BC01','But chi','cay','Singapore',3000)
INSERT INTO dbo.SANPHAM VALUES('BC02','But chi','cay','Singapore',5000)
INSERT INTO dbo.SANPHAM VALUES('BC03','But chi','cay','Viet Nam',3500)
INSERT INTO dbo.SANPHAM VALUES('BC04','But chi','hop','Viet Nam',30000)
INSERT INTO dbo.SANPHAM VALUES('BB01','But bi','cay','Viet Nam',5000)
INSERT INTO dbo.SANPHAM VALUES('BB02','But bi','cay','Trung Quoc',7000)
INSERT INTO dbo.SANPHAM VALUES('BB03','But bi','hop','Thai Lan',100000)
INSERT INTO dbo.SANPHAM VALUES('TV01','Tap 100 giay mong','quyen','Trung Quoc',2500)
INSERT INTO dbo.SANPHAM VALUES('TV02','Tap 200 giay mong','quyen','Trung Quoc',4500)
INSERT INTO dbo.SANPHAM VALUES('TV03','Tap 100 giay tot','quyen','Viet Nam',3000)
INSERT INTO dbo.SANPHAM VALUES('TV04','Tap 200 giay tot','quyen','Viet Nam',5500)
INSERT INTO dbo.SANPHAM VALUES('TV05','Tap 100 trang','chuc','Viet Nam',23000)
INSERT INTO dbo.SANPHAM VALUES('TV06','Tap 200 trang','chuc','Viet Nam',53000)
INSERT INTO dbo.SANPHAM VALUES('TV07','Tap 100 trang','chuc','Trung Quoc',34000)
INSERT INTO dbo.SANPHAM VALUES('ST01','So tay 500 trang','quyen','Trung Quoc',40000)
INSERT INTO dbo.SANPHAM VALUES('ST02','So tay loai 1','quyen','Viet Nam',55000)
INSERT INTO dbo.SANPHAM VALUES('ST03','So tay loai 2','quyen','Viet Nam',51000)
INSERT INTO dbo.SANPHAM VALUES('ST04','So tay','quyen','Thai Lan',55000)
INSERT INTO dbo.SANPHAM VALUES('ST05','So tay mong','quyen','Thai Lan',20000)
INSERT INTO dbo.SANPHAM VALUES('ST06','Phan viet bang','hop','Viet Nam',5000)
INSERT INTO dbo.SANPHAM VALUES('ST07','Phan khong bui','hop','Viet Nam',7000)
INSERT INTO dbo.SANPHAM VALUES('ST08','Bong bang','cai','Viet Nam',1000)
INSERT INTO dbo.SANPHAM VALUES('ST09','But long','cay','Viet Nam',5000)
INSERT INTO dbo.SANPHAM VALUES('ST10','But long','cay','Trung Quoc',7000)

-- HOADON
INSERT INTO dbo.HOADON VALUES(1001,'23/07/2006','KH01','NV01',320000)
INSERT INTO dbo.HOADON VALUES(1002,'12/08/2006','KH01','NV02',840000)
INSERT INTO dbo.HOADON VALUES(1003,'23/08/2006','KH02','NV01',100000)
INSERT INTO dbo.HOADON VALUES(1004,'01/09/2006','KH02','NV01',180000)
INSERT INTO dbo.HOADON VALUES(1005,'20/10/2006','KH01','NV02',3800000)
INSERT INTO dbo.HOADON VALUES(1006,'16/10/2006','KH01','NV03',2430000)
INSERT INTO dbo.HOADON VALUES(1007,'28/10/2006','KH03','NV03',510000)
INSERT INTO dbo.HOADON VALUES(1008,'28/10/2006','KH01','NV03',440000)
INSERT INTO dbo.HOADON VALUES(1009,'28/10/2006','KH03','NV04',200000)
INSERT INTO dbo.HOADON VALUES(1010,'01/11/2006','KH01','NV01',5200000)
INSERT INTO dbo.HOADON VALUES(1011,'04/11/2006','KH04','NV03',250000)
INSERT INTO dbo.HOADON VALUES(1012,'30/11/2006','KH05','NV03',21000)
INSERT INTO dbo.HOADON VALUES(1013,'12/12/2006','KH06','NV01',5000)
INSERT INTO dbo.HOADON VALUES(1014,'31/12/2006','KH03','NV02',3150000)
INSERT INTO dbo.HOADON VALUES(1015,'01/01/2007','KH06','NV01',910000)
INSERT INTO dbo.HOADON VALUES(1016,'01/01/2007','KH07','NV02',12500)
INSERT INTO dbo.HOADON VALUES(1017,'02/01/2007','KH08','NV03',35000)
INSERT INTO dbo.HOADON VALUES(1018,'13/01/2007','KH08','NV03',330000)
INSERT INTO dbo.HOADON VALUES(1019,'13/01/2007','KH01','NV03',30000)
INSERT INTO dbo.HOADON VALUES(1020,'14/01/2007','KH09','NV04',70000)
INSERT INTO dbo.HOADON VALUES(1021,'16/01/2007','KH10','NV03',67500)
INSERT INTO dbo.HOADON VALUES(1022,'16/01/2007',Null,'NV03',7000)
INSERT INTO dbo.HOADON VALUES(1023,'17/01/2007',Null,'NV01',330000)

-- CTHD
INSERT INTO dbo.CTHD VALUES(1001,'TV02',10)
INSERT INTO dbo.CTHD VALUES(1001,'ST01',5)
INSERT INTO dbo.CTHD VALUES(1001,'BC01',5)
INSERT INTO dbo.CTHD VALUES(1001,'BC02',10)
INSERT INTO dbo.CTHD VALUES(1001,'ST08',10)
INSERT INTO dbo.CTHD VALUES(1002,'BC04',20)
INSERT INTO dbo.CTHD VALUES(1002,'BB01',20)
INSERT INTO dbo.CTHD VALUES(1002,'BB02',20)
INSERT INTO dbo.CTHD VALUES(1003,'BB03',10)
INSERT INTO dbo.CTHD VALUES(1004,'TV01',20)
INSERT INTO dbo.CTHD VALUES(1004,'TV02',10)
INSERT INTO dbo.CTHD VALUES(1004,'TV03',10)
INSERT INTO dbo.CTHD VALUES(1004,'TV04',10)
INSERT INTO dbo.CTHD VALUES(1005,'TV05',50)
INSERT INTO dbo.CTHD VALUES(1005,'TV06',50)
INSERT INTO dbo.CTHD VALUES(1006,'TV07',20)
INSERT INTO dbo.CTHD VALUES(1006,'ST01',30)
INSERT INTO dbo.CTHD VALUES(1006,'ST02',10)
INSERT INTO dbo.CTHD VALUES(1007,'ST03',10)
INSERT INTO dbo.CTHD VALUES(1008,'ST04',8)
INSERT INTO dbo.CTHD VALUES(1009,'ST05',10)
INSERT INTO dbo.CTHD VALUES(1010,'TV07',50)
INSERT INTO dbo.CTHD VALUES(1010,'ST07',50)
INSERT INTO dbo.CTHD VALUES(1010,'ST08',100)
INSERT INTO dbo.CTHD VALUES(1010,'ST04',50)
INSERT INTO dbo.CTHD VALUES(1010,'TV03',100)
INSERT INTO dbo.CTHD VALUES(1011,'ST06',50)
INSERT INTO dbo.CTHD VALUES(1012,'ST07',3)
INSERT INTO dbo.CTHD VALUES(1013,'ST08',5)
INSERT INTO dbo.CTHD VALUES(1014,'BC02',80)
INSERT INTO dbo.CTHD VALUES(1014,'BB02',100)
INSERT INTO dbo.CTHD VALUES(1014,'BC04',60)
INSERT INTO dbo.CTHD VALUES(1014,'BB01',50)
INSERT INTO dbo.CTHD VALUES(1015,'BB02',30)
INSERT INTO dbo.CTHD VALUES(1015,'BB03',7)
INSERT INTO dbo.CTHD VALUES(1016,'TV01',5)
INSERT INTO dbo.CTHD VALUES(1017,'TV02',1)
INSERT INTO dbo.CTHD VALUES(1017,'TV03',1)
INSERT INTO dbo.CTHD VALUES(1017,'TV04',5)
INSERT INTO dbo.CTHD VALUES(1018,'ST04',6)
INSERT INTO dbo.CTHD VALUES(1019,'ST05',1)
INSERT INTO dbo.CTHD VALUES(1019,'ST06',2)
INSERT INTO dbo.CTHD VALUES(1020,'ST07',10)
INSERT INTO dbo.CTHD VALUES(1021,'ST08',5)
INSERT INTO dbo.CTHD VALUES(1021,'TV01',7)
INSERT INTO dbo.CTHD VALUES(1021,'TV02',10)
INSERT INTO dbo.CTHD VALUES(1022,'ST07',1)
INSERT INTO dbo.CTHD VALUES(1023,'ST04',6)
---------Bài 2
SELECT * INTO SANPHAM1 FROM SANPHAM
SELECT * INTO KHACHHANG1 FROM KHACHHANG
--------Bài 3: 3.	Cập nhật giá tăng 5% đối với những sản phẩm do “Thai Lan” sản xuất (cho quan hệ SANPHAM1)
UPDATE SANPHAM1 SET GIA=GIA+GIA*0.05 WHERE NUOCSX='Thai Lan'
-------Bài 4: 4.	Cập nhật giá giảm 5% đối với những sản phẩm do “Trung Quoc” sản xuất có giá từ 10.000 trở xuống (cho quan hệ SANPHAM1)
UPDATE SANPHAM1 SET GIA=GIA-GIA*0.05 WHERE NUOCSX='Trung Quoc'
------Bài 5: 5.	Cập nhật giá trị LOAIKH là “Vip” đối với những khách hàng đăng ký thành viên trước ngày 1/1/2007 có doanh số từ 10.000.000 trở lên hoặc khách hàng đăng ký thành viên từ 1/1/2007 trở về sau có doanh số từ 2.000.000 trở lên (cho quan hệ KHACHHANG1).
UPDATE KHACHHANG1 SET LOAIKH='Vip' WHERE (NGDK<'01/01/2007' AND DOANHSO >10000000) OR (NGDK<='01/01/2007' AND DOANHSO>2000000)
------Phần 3:
--1.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” sản xuất.
SELECT MASP, TENSP FROM SANPHAM WHERE NUOCSX='Trung Quoc'
--2.	In ra danh sách các sản phẩm (MASP, TENSP) có đơn vị tính là “cay”, ”quyen”.
SELECT MASP, TENSP FROM SANPHAM WHERE DVT IN ('cay', 'quyen')
--3.	In ra danh sách các sản phẩm (MASP,TENSP) có mã sản phẩm bắt đầu là “B” và kết thúc là “01”.
SELECT MASP, TENSP FROM SANPHAM WHERE MASP LIKE 'B%01'
--4.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quốc” sản xuất có giá từ 30.000 đến 40.000.
SELECT MASP, TENSP FROM SANPHAM WHERE NUOCSX='Trung Quoc' AND GIA BETWEEN 30000 AND 40000
--5.	In ra danh sách các sản phẩm (MASP,TENSP) do “Trung Quoc” hoặc “Thai Lan” sản xuất có giá từ 30.000 đến 40.000.
SELECT MASP, TENSP FROM SANPHAM WHERE NUOCSX IN ('Trung Quoc', 'Thai Lan') AND GIA BETWEEN 30000 AND 40000
--6.	In ra các số hóa đơn, trị giá hóa đơn bán ra trong ngày 1/1/2007 và ngày 2/1/2007.
SELECT SOHD, TRIGIA FROM HOADON WHERE NGHD>='01/01/2007' AND NGHD<='01/02/2007'
SELECT SOHD, TRIGIA FROM HOADON WHERE NGHD>='01/01/2007' AND NGHD<='02/01/2007' --Em không chắc là ngày trước tháng sau hay ngày sau tháng trước nên làm 2 câu lệnh
--7.	In ra các số hóa đơn, trị giá hóa đơn trong tháng 1/2007, sắp xếp theo ngày (tăng dần) và trị giá của hóa đơn (giảm dần).
SELECT SOHD, TRIGIA FROM HOADON WHERE MONTH(NGHD)=1 AND YEAR(NGHD)=2007 ORDER BY NGHD ASC, TRIGIA DESC
--8.	In ra danh sách các khách hàng (MAKH, HOTEN) đã mua hàng trong ngày 1/1/2007.
SELECT K.MAKH, K.HOTEN FROM KHACHHANG AS K INNER JOIN HOADON AS H ON K.MAKH=H.MAKH WHERE H.NGHD='01/01/2007'
--9.	In ra số hóa đơn, trị giá các hóa đơn do nhân viên có tên “Nguyen Van B” lập trong ngày 28/10/2006.
SELECT H.SOHD, H.TRIGIA FROM HOADON AS H INNER JOIN NHANVIEN AS N ON N.MANV=H.MANV WHERE N.HOTEN='Nguyen Van B' AND H.NGHD='28/10/2006'
--10.	In ra danh sách các sản phẩm (MASP,TENSP) được khách hàng có tên “Nguyen Van A” mua trong tháng 10/2006.
SELECT S.MASP, S.TENSP FROM SANPHAM S, CTHD C, HOADON H, KHACHHANG K WHERE S.MASP=C.MASP AND C.SOHD=H.SOHD AND H.MAKH=K.MAKH AND K.HOTEN='Nguyen Van A' AND MONTH(H.NGHD)=10 AND YEAR(H.NGHD)=2006
--11.	Tìm các số hóa đơn đã mua sản phẩm có mã số “BB01” hoặc “BB02”.
SELECT C.SOHD FROM CTHD C WHERE C.MASP IN ('BB01', 'BB02')